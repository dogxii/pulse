@import "tailwindcss";

/* 启用 Tailwind dark mode (class 策略) */
@custom-variant dark (&:where(.dark, .dark *));

/* 自定义 CSS 变量用于主题 */
:root {
  /* Light 主题颜色 */
  --color-bg-primary: #fafafa;
  --color-bg-secondary: #ffffff;
  --color-bg-tertiary: #f3f4f6;
  --color-text-primary: #111827;
  --color-text-secondary: #4b5563;
  --color-text-tertiary: #9ca3af;
  --color-border: #e5e7eb;
  --color-border-hover: #d1d5db;

  /* Safe Area Insets (PWA 适配) */
  --safe-area-inset-top: env(safe-area-inset-top, 0px);
  --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-inset-left: env(safe-area-inset-left, 0px);
  --safe-area-inset-right: env(safe-area-inset-right, 0px);
}

.dark {
  /* Dark 主题颜色 */
  --color-bg-primary: #0f0f0f;
  --color-bg-secondary: #1a1a1a;
  --color-bg-tertiary: #262626;
  --color-text-primary: #f9fafb;
  --color-text-secondary: #d1d5db;
  --color-text-tertiary: #6b7280;
  --color-border: #374151;
  --color-border-hover: #4b5563;
}

/* 全局基础样式 */
body {
  @apply bg-gray-50/50 text-gray-900 dark:bg-[#0f0f0f] dark:text-gray-100;
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* ========== PWA Safe Area 适配 ========== */

/* PWA 独立模式下的顶部安全区域适配 - 减少一半边距 */
@media all and (display-mode: standalone) {
  body {
    padding-top: calc(env(safe-area-inset-top, 0px) / 2);
    padding-top: calc(constant(safe-area-inset-top, 0px) / 2); /* iOS 11.0-11.2 兼容 */
    padding-bottom: env(safe-area-inset-bottom, 0px);
    padding-bottom: constant(safe-area-inset-bottom, 0px);
  }
}

/* iOS PWA 全屏模式适配 - 减少一半边距 */
@supports (padding-top: env(safe-area-inset-top)) {
  @media all and (display-mode: standalone) {
    .pwa-safe-top {
      padding-top: calc(env(safe-area-inset-top, 0px) / 2);
    }

    .pwa-safe-bottom {
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }
  }
}

/* ========== iOS 输入框自动缩放修复 ========== */
/* iOS Safari 在输入元素字体小于 16px 时会自动放大页面 */
/* 设置 font-size >= 16px 可防止此行为 */

input,
textarea,
select {
  font-size: 16px !important; /* 防止 iOS 自动缩放 */
}

/* 在桌面端恢复正常字体大小 */
@media (min-width: 1024px) {
  input,
  textarea,
  select {
    font-size: inherit !important;
  }
}

/* 编辑器特定样式 - 确保移动端不触发缩放 */
.markdown-editor textarea {
  font-size: 16px !important;
  /* 确保在移动端有足够的触控空间 */
  min-height: 200px;
}

@media (min-width: 1024px) {
  .markdown-editor textarea {
    font-size: 14px !important; /* 桌面端使用较小字体 */
  }
}

/* ========== 移动端优化 ========== */

/* 移动端更大的触控目标 */
@media (max-width: 768px) {
  /* 按钮和交互元素的最小触控区域 */
  button,
  [role="button"],
  a {
    min-height: 44px;
    min-width: 44px;
  }

  /* 小型图标按钮例外 */
  button.icon-btn-sm,
  [role="button"].icon-btn-sm {
    min-height: 36px;
    min-width: 36px;
  }

  /* 工具栏按钮适配 */
  .markdown-editor .toolbar-btn {
    padding: 10px;
    min-height: 40px;
    min-width: 40px;
  }
}

/* ========== 滚动条样式 ========== */

::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  @apply bg-gray-100 dark:bg-gray-800;
}

::-webkit-scrollbar-thumb {
  @apply bg-gray-300 dark:bg-gray-600 rounded-full;
}

::-webkit-scrollbar-thumb:hover {
  @apply bg-gray-400 dark:bg-gray-500;
}

/* 移动端隐藏滚动条（保持滚动功能） */
@media (max-width: 768px) {
  ::-webkit-scrollbar {
    width: 0;
    height: 0;
  }
}

/* ========== Selection 样式 ========== */

::selection {
  @apply bg-emerald-100 text-emerald-900 dark:bg-emerald-900/50 dark:text-emerald-100;
}

/* ========== 动画 ========== */

/* 慢速旋转动画（用于 PWA 更新图标） */
@keyframes spin-slow {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.animate-spin-slow {
  animation: spin-slow 2s linear infinite;
}

/* FAB 脉冲动画 */
@keyframes pulse-ring {
  0% {
    transform: scale(0.8);
    opacity: 0.8;
  }
  50% {
    transform: scale(1);
    opacity: 0.4;
  }
  100% {
    transform: scale(0.8);
    opacity: 0.8;
  }
}

.animate-pulse-ring {
  animation: pulse-ring 2s ease-in-out infinite;
}

/* ========== FAB (Floating Action Button) 样式 ========== */

.fab {
  @apply fixed z-50 rounded-full shadow-lg transition-all duration-200;
  /* 确保 FAB 在安全区域之上 */
  bottom: calc(24px + env(safe-area-inset-bottom, 0px));
}

.fab-right {
  right: 24px;
}

.fab-left {
  left: 24px;
}

/* 移动端 FAB 位置调整 */
@media (max-width: 768px) {
  .fab {
    bottom: calc(20px + env(safe-area-inset-bottom, 0px));
  }

  .fab-right {
    right: 20px;
  }

  .fab-left {
    left: 20px;
  }
}

/* ========== 移动端编辑器优化 ========== */

@media (max-width: 768px) {
  /* 编辑器容器更宽松的间距 */
  .markdown-editor {
    @apply rounded-2xl;
  }

  /* 工具栏水平滚动 */
  .markdown-editor .toolbar {
    @apply overflow-x-auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }

  .markdown-editor .toolbar::-webkit-scrollbar {
    display: none;
  }

  /* 编辑区域更大的内边距和行高 */
  .markdown-editor textarea {
    @apply px-4 py-4 leading-relaxed;
    line-height: 1.8;
  }

  /* 预览区域优化 */
  .markdown-editor .preview {
    @apply px-4 py-4;
  }
}

/* ========== 键盘弹出时的布局适配 ========== */

/* 当虚拟键盘弹出时，确保输入框可见 */
@supports (height: 100dvh) {
  .keyboard-aware {
    min-height: 100dvh;
  }
}

/* 确保底部固定元素在键盘弹出时正确定位 */
.fixed-bottom-safe {
  bottom: env(safe-area-inset-bottom, 0px);
}

/* ========== 通用工具类 ========== */

/* 禁用文本选择 */
.select-none {
  -webkit-user-select: none;
  user-select: none;
}

/* 启用触摸滚动优化 */
.touch-scroll {
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

/* 硬件加速 */
.gpu {
  transform: translateZ(0);
  will-change: transform;
}
